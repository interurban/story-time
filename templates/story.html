{% extends "base.html" %}

{% block title %}{{ story.title }} - Bedtime Story Generator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <h1 class="card-title">{{ story.title }}</h1>
                    <div class="btn-group">
                        <a href="{{ url_for('edit_story', story_id=story.id) }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-edit me-1"></i>Edit
                        </a>
                        <a href="{{ url_for('export_pdf', story_id=story.id) }}" class="btn btn-outline-success btn-sm">
                            <i class="fas fa-download me-1"></i>PDF
                        </a>
                        <button class="btn btn-outline-primary btn-sm" onclick="printStory()">
                            <i class="fas fa-print me-1"></i>Print
                        </button>
                    </div>
                </div>
                
                <div class="story-metadata mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="text-muted mb-1">
                                <i class="fas fa-tag me-1"></i>
                                <strong>Theme:</strong> {{ story.theme.title() }}
                            </p>
                            <p class="text-muted mb-1">
                                <i class="fas fa-birthday-cake me-1"></i>
                                <strong>Age Group:</strong> {{ story.age_group }} years old
                            </p>
                            {% if story.child_name %}
                            <p class="text-muted mb-1">
                                <i class="fas fa-user me-1"></i>
                                <strong>Created for:</strong> {{ story.child_name }}
                            </p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <p class="text-muted mb-1">
                                <i class="fas fa-clock me-1"></i>
                                <strong>Length:</strong> {{ story.story_length.title() }}
                            </p>
                            <p class="text-muted mb-1">
                                <i class="fas fa-calendar me-1"></i>
                                <strong>Created:</strong> {{ story.created_date.strftime('%B %d, %Y at %I:%M %p') }}
                            </p>
                        </div>
                    </div>
                </div>
                
                {% if story.user_notes %}
                <div class="alert alert-info mb-4">
                    <h6><i class="fas fa-sticky-note me-1"></i>Personal Notes:</h6>
                    <p class="mb-0">{{ story.user_notes }}</p>
                </div>
                {% endif %}
                
                <div class="story-content" id="storyContent">
                    {% for paragraph in story.content.split('\n\n') %}
                    {% if paragraph.strip() %}
                    <p>{{ paragraph.strip() }}</p>
                    {% endif %}
                    {% endfor %}
                </div>
                
                <div class="mt-4 text-center">
                    <a href="{{ url_for('list_stories') }}" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-arrow-left me-1"></i>Back to Stories
                    </a>
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <i class="fas fa-magic me-1"></i>Create New Story
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function printStory() {
    const printWindow = window.open('', '_blank');
    const storyTitle = "{{ story.title }}";
    const storyContent = document.getElementById('storyContent').innerHTML;
    const childName = "{{ story.child_name or '' }}";
    const createdDate = "{{ story.created_date.strftime('%B %d, %Y') }}";
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>${storyTitle}</title>
            <style>
                body { 
                    font-family: 'Times New Roman', serif; 
                    margin: 40px; 
                    line-height: 1.8; 
                    color: #333;
                }
                h1 { 
                    text-align: center; 
                    color: #6f42c1; 
                    margin-bottom: 30px; 
                    font-size: 24px;
                }
                p { 
                    margin-bottom: 18px; 
                    font-size: 16px; 
                    text-align: justify;
                }
                .footer {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    font-size: 12px;
                    color: #666;
                }
                @media print { 
                    body { margin: 20px; }
                    .footer { position: absolute; }
                }
            </style>
        </head>
        <body>
            <h1>${storyTitle}</h1>
            ${storyContent}
            <div class="footer">
                ${childName ? `Created for ${childName} â€¢ ` : ''}${createdDate}
            </div>
        </body>
        </html>
    `);
    
    printWindow.document.close();
    printWindow.print();
}
</script>
{% endblock %}
